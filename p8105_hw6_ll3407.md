p8105_hw6_ll3407
================
2022-11-25

## Problem 2

Create a city_state variable and a binary variable indicating whether
the homicide is solved. Omit four cities. Limit to whites and blacks.

``` r
homicide = read_csv(file = "./data/homicide-data.csv") %>%
  janitor::clean_names() %>% 
  unite("city_state",c("city", "state"), sep = ",") %>% 
  mutate(
    resolved = recode(
       disposition, 'Closed by arrest' = 1, 'Closed without arrest' = 0, 'Open/No arrest' = 0)) %>% 
  filter(city_state != c("Dallas,TX", "Phoenix,AZ", "Kansas City,MO", "Tulsa,AL")) %>% 
  filter(victim_race == c("White","Black"))%>% 
  mutate(victim_age = as.numeric(victim_age))
```

    ## Rows: 52179 Columns: 12
    ## -- Column specification --------------------------------------------------------
    ## Delimiter: ","
    ## chr (9): uid, victim_last, victim_first, victim_race, victim_age, victim_sex...
    ## dbl (3): reported_date, lat, lon
    ## 
    ## i Use `spec()` to retrieve the full column specification for this data.
    ## i Specify the column types or set `show_col_types = FALSE` to quiet this message.

Fit a logistic regression model for Baltimore

``` r
Baltimore = homicide %>% 
  filter(city_state == "Baltimore,MD") 

  fit_Baltimore = glm(resolved ~ victim_age + victim_sex + victim_race, data = Baltimore)
```

OR and 95% CIs for the resolved homicide comparing male to female in
Baltimore

``` r
OR_Baltimore = fit_Baltimore %>% broom::tidy() %>%
  filter(term == "victim_sexMale") %>% 
  select(estimate, std.error) %>% 
  mutate(
    OR_M_to_F = exp(estimate),
    ci_lower = exp(estimate-1.96*std.error), 
    ci_upper = exp(estimate+1.96*std.error)
  )
```

GLM for each city. OR and 95% CI for resolved homicides comparing male
to female.

``` r
nest = homicide %>% 
  select(city_state,resolved,victim_age,victim_sex,victim_race) %>% 
  mutate(race = recode(
       victim_race, 'Black' = 1, 'White' = 0)) %>% 
  mutate(sex_male = recode(
       victim_sex, 'Male' = 1, 'Female' = 0, 'Unknown' = 0)) %>% 
   mutate(sex_unknown = recode(
       victim_sex, 'Unknown' = 1, 'Female' = 0, 'Male' = 0))  %>% 
  nest(df = -city_state) 

OR = nest %>% 
  mutate(
    models = map(.x = df, ~lm(resolved ~ victim_age + sex_male + sex_unknown + race , data = .x )),
    results = map(models, broom::tidy)
  ) %>% 
  select(city_state,results) %>% 
  unnest(results) 
  
  OR_all = OR%>%
  filter(term == "sex_male") %>% 
  select(city_state, estimate, std.error) %>% 
  mutate(
    OR_M_to_F = exp(estimate),
    ci_lower = exp(estimate-1.96*std.error), 
    ci_upper = exp(estimate+1.96*std.error)
  ) %>% 
    select( -estimate, -std.error) 
```

Plot of ORs and CIs for each city.

``` r
plot_OR = OR_all %>% ggplot(aes(reorder(city_state,OR_M_to_F), y = OR_M_to_F)) + geom_point() + 
    geom_errorbar(aes(ymin = ci_lower, ymax = ci_upper))+ 
  labs(
    title = "Plot of Plot of ORs and CIs for resolved homicides comparing male to female in each city",
    x = "City",
    y = "OR and 95% CIs") +
  theme(axis.text.x = element_text(angle = 70, vjust = 0.5, hjust = 1))

plot_OR
```

<img src="p8105_hw6_ll3407_files/figure-gfm/unnamed-chunk-5-1.png" width="90%" />
Comment: Telsa in AL has the highest OR of resolved homicides comparing
males to females, while New York in NY has the lowest. San Bernardino in
CA has the widest CI range of resolved homicides comparing males to
females, while Chicago in IL has the narrowest.
